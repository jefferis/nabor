<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Wrapper classes for k-NN searches enabling repeated queries of the same tree — WKNNF-class • nabor</title>

<!-- jquery -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script>
<!-- Bootstrap -->

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha256-916EbMg70RQy9LHiGkXzG8hSg9EdNy97GazNG/aiY1w=" crossorigin="anonymous" />
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha256-U5ZEeKfGNOja007MMD3YBI0A3OSZOQbeG6z2f2Y0hu8=" crossorigin="anonymous"></script>

<!-- Font Awesome icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" integrity="sha256-eZrrJcwDc/3uDhsdt61sL2oOBY362qM3lon1gyExkL0=" crossorigin="anonymous" />

<!-- clipboard.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" integrity="sha256-FiZwavyI2V6+EXO1U+xzLG3IKldpiTFf3153ea9zikQ=" crossorigin="anonymous"></script>

<!-- sticky kit -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/sticky-kit/1.1.3/sticky-kit.min.js" integrity="sha256-c4Rlo1ZozqTPE2RLuvbusY3+SU1pQaJC0TjuhygMipw=" crossorigin="anonymous"></script>

<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script>



<meta property="og:title" content="Wrapper classes for k-NN searches enabling repeated queries of the same tree — WKNNF-class" />

<meta property="og:description" content="WKNNF and WKNND are reference classes that wrap 
  C++ classes of the same name that include a space-efficient k-d tree along 
  with the target data points. They have query methods with exactly 
  the same interface as the knn function. One important point compared
  with knn - they must be intialised with floating point data and you 
  are responsible for this - see storage.mode) and the example 
  below." />
<meta name="twitter:card" content="summary" />



<!-- mathjax -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->


  </head>

  <body>
    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">nabor</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.5.1</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="../index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
      
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://github.com/jefferis/nabor">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
      
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      
      </header>

<div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Wrapper classes for k-NN searches enabling repeated queries of the same tree</h1>
    <small class="dont-index">Source: <a href='https://github.com/jefferis/nabor/blob/master/R/WKNNClasses.R'><code>R/WKNNClasses.R</code></a></small>
    <div class="hidden name"><code>WKNN-class.Rd</code></div>
    </div>

    <div class="ref-description">
    
    <p><code>WKNNF</code> and <code>WKNND</code> are reference classes that wrap 
  C++ classes of the same name that include a space-efficient k-d tree along 
  with the target data points. They have <code>query</code> methods with exactly 
  the same interface as the <code>knn</code> function. One important point compared
  with <code>knn</code> - they must be intialised with floating point data and you 
  are responsible for this - see <code><a href='https://www.rdocumentation.org/packages/base/topics/mode'>storage.mode</a></code>) and the example 
  below.</p>
    
    </div>

        
    <h2 class="hasAnchor" id="details"><a class="anchor" href="#details"></a>Details</h2>

    <p><code>WKNNF</code> expects and returns matrices in R's standard (double, 8
  bytes) data type but uses floats internally. <code>WKNND</code> uses doubles 
  throughout. When retaining large numbers of points, the <code>WKNNF</code> 
  objects will have a small memory saving, especially if tree building is 
  delayed.</p>  
<p>The constructor for WKNN objects includes a logical flag indicating whether
  to build the tree immediately (default: <code>TRUE</code>) or (when <code>FALSE</code>)
  to delay building the tree until a query is made (this happens 
  automatically when required).</p>
    
    <h2 class="hasAnchor" id="performance"><a class="anchor" href="#performance"></a>Performance</h2>

    <p>The use of <code>WKNN</code> objects will incur a performance
  penalty for single queries of trees with &lt; ~1000 data points. This is 
  because of the overhead associated with the R wrapper class. It therefore 
  makes sense to use <code>knn</code> in these circumstances.</p>  
<p>If you wish to make repeated queries of the same target data, then using 
  <code>WKNN</code> objects can give significant advantages. If you are going to 
  make repeated queries with the same set of query points (presumably against
  different target data), you can obtain benefits in some cases by converting
  the query points into WKNNF objects without building the trees.</p>
    
    <h2 class="hasAnchor" id="see-also"><a class="anchor" href="#see-also"></a>See also</h2>

    <div class='dont-index'><p><code><a href='knn.html'>knn</a></code></p></div>
    

    <h2 class="hasAnchor" id="examples"><a class="anchor" href="#examples"></a>Examples</h2>
    <pre class="examples"><div class='input'><span class='co'>## Basic usage</span>
<span class='co'># load sample data consisting of list of 3 separate 3d pointets</span>
<span class='fu'><a href='https://www.rdocumentation.org/packages/utils/topics/data'>data</a></span>(<span class='no'>kcpoints</span>)
<span class='co'># build a tree and query it with two different sets of points</span>
<span class='no'>w1</span> <span class='kw'>&lt;-</span> <span class='fu'>WKNNF</span>(<span class='no'>kcpoints</span><span class='kw'>[[</span><span class='fl'>1</span>]])
<span class='no'>w1q2</span> <span class='kw'>&lt;-</span> <span class='no'>w1</span>$<span class='fu'>query</span>(<span class='no'>kcpoints</span><span class='kw'>[[</span><span class='fl'>2</span>]], <span class='kw'>k</span><span class='kw'>=</span><span class='fl'>5</span>, <span class='kw'>eps</span><span class='kw'>=</span><span class='fl'>0</span>, <span class='kw'>radius</span><span class='kw'>=</span><span class='fl'>0</span>)
<span class='fu'><a href='https://www.rdocumentation.org/packages/utils/topics/str'>str</a></span>(<span class='no'>w1q2</span>)</div><div class='output co'>#&gt; List of 2
#&gt;  $ nn.idx  : int [1:297, 1:5] 42 42 42 42 42 42 9 9 9 9 ...
#&gt;  $ nn.dists: num [1:297, 1:5] 16.3 10.9 16.2 12.1 10.7 ...</div><div class='input'><span class='no'>w1q3</span> <span class='kw'>&lt;-</span> <span class='no'>w1</span>$<span class='fu'>query</span>(<span class='no'>kcpoints</span><span class='kw'>[[</span><span class='fl'>3</span>]], <span class='kw'>k</span><span class='kw'>=</span><span class='fl'>5</span>, <span class='kw'>eps</span><span class='kw'>=</span><span class='fl'>0</span>, <span class='kw'>radius</span><span class='kw'>=</span><span class='fl'>0</span>)
<span class='co'># note that there will be small difference between WKNNF and knn due to loss </span>
<span class='co'># of precision in the double to float conversion when a WKNNF tree is </span>
<span class='co'># built and queried.</span>
<span class='fu'><a href='https://www.rdocumentation.org/packages/base/topics/stopifnot'>stopifnot</a></span>(<span class='fu'><a href='https://www.rdocumentation.org/packages/base/topics/all.equal'>all.equal</a></span>(
 <span class='fu'><a href='knn.html'>knn</a></span>(<span class='kw'>data</span><span class='kw'>=</span><span class='no'>kcpoints</span><span class='kw'>[[</span><span class='fl'>1</span>]], <span class='kw'>query</span><span class='kw'>=</span><span class='no'>kcpoints</span><span class='kw'>[[</span><span class='fl'>2</span>]], <span class='kw'>k</span><span class='kw'>=</span><span class='fl'>5</span>, <span class='kw'>eps</span><span class='kw'>=</span><span class='fl'>0</span>, <span class='kw'>radius</span><span class='kw'>=</span><span class='fl'>0</span>),
 <span class='no'>w1q2</span>, <span class='kw'>tolerance</span><span class='kw'>=</span><span class='fl'>1e-6</span>))

<span class='co'>## storage mode: must be double</span>
<span class='no'>m</span><span class='kw'>=</span><span class='fu'><a href='https://www.rdocumentation.org/packages/base/topics/matrix'>matrix</a></span>(<span class='fl'>1</span>:<span class='fl'>24</span>, <span class='kw'>ncol</span><span class='kw'>=</span><span class='fl'>3</span>)
<span class='fu'><a href='https://www.rdocumentation.org/packages/base/topics/mode'>storage.mode</a></span>(<span class='no'>m</span>)</div><div class='output co'>#&gt; [1] "integer"</div><div class='input'><span class='co'># this will generate an error unless we change to a double</span>
<span class='no'>w</span><span class='kw'>=</span><span class='kw pkg'>tools</span><span class='kw ns'>::</span><span class='fu'><a href='https://www.rdocumentation.org/packages/tools/topics/assertCondition'>assertCondition</a></span>(<span class='fu'>WKNND</span>(<span class='no'>m</span>), <span class='st'>"error"</span>)
<span class='fu'><a href='https://www.rdocumentation.org/packages/base/topics/mode'>storage.mode</a></span>(<span class='no'>m</span>)<span class='kw'>=</span><span class='st'>"double"</span>
<span class='no'>w</span><span class='kw'>=</span><span class='fu'>WKNND</span>(<span class='fu'><a href='https://www.rdocumentation.org/packages/base/topics/matrix'>matrix</a></span>(<span class='no'>m</span>, <span class='kw'>ncol</span><span class='kw'>=</span><span class='fl'>3</span>))

<span class='co'>## construct wrapper objects but delay tree construction</span>
<span class='no'>w1</span> <span class='kw'>&lt;-</span> <span class='fu'>WKNNF</span>(<span class='no'>kcpoints</span><span class='kw'>[[</span><span class='fl'>1</span>]], <span class='fl'>FALSE</span>)
<span class='co'># query triggers tree construction</span>
<span class='no'>w1q2</span> <span class='kw'>&lt;-</span> <span class='no'>w1</span>$<span class='fu'>query</span>(<span class='no'>kcpoints</span><span class='kw'>[[</span><span class='fl'>2</span>]], <span class='kw'>k</span><span class='kw'>=</span><span class='fl'>5</span>, <span class='kw'>eps</span><span class='kw'>=</span><span class='fl'>0</span>, <span class='kw'>radius</span><span class='kw'>=</span><span class='fl'>0</span>)
<span class='fu'><a href='https://www.rdocumentation.org/packages/utils/topics/str'>str</a></span>(<span class='no'>w1q2</span>)</div><div class='output co'>#&gt; List of 2
#&gt;  $ nn.idx  : int [1:297, 1:5] 42 42 42 42 42 42 9 9 9 9 ...
#&gt;  $ nn.dists: num [1:297, 1:5] 16.3 10.9 16.2 12.1 10.7 ...</div><div class='input'>
<span class='co'>## queries using wrapper objects</span>
<span class='no'>wkcpoints</span> <span class='kw'>&lt;-</span><span class='fu'><a href='https://www.rdocumentation.org/packages/base/topics/lapply'>lapply</a></span>(<span class='no'>kcpoints</span>, <span class='no'>WKNNF</span>, <span class='fl'>FALSE</span>)
<span class='co'># query all 3 point sets against first</span>
<span class='co'># this will trigger tree construction only for pointset 1</span>
<span class='no'>qall</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='https://www.rdocumentation.org/packages/base/topics/lapply'>lapply</a></span>(<span class='no'>wkcpoints</span>,
  <span class='kw'>function</span>(<span class='no'>x</span>) <span class='no'>wkcpoints</span><span class='kw'>[[</span><span class='fl'>1</span>]]$<span class='fu'>queryWKNN</span>(<span class='no'>x</span>$<span class='no'>.CppObject</span>, <span class='kw'>k</span><span class='kw'>=</span><span class='fl'>5</span>, <span class='kw'>eps</span><span class='kw'>=</span><span class='fl'>0</span>, <span class='kw'>radius</span><span class='kw'>=</span><span class='fl'>0</span>))
<span class='fu'><a href='https://www.rdocumentation.org/packages/utils/topics/str'>str</a></span>(<span class='no'>qall</span>)</div><div class='output co'>#&gt; List of 3
#&gt;  $ FruMARCM-M001205_seg002:List of 2
#&gt;   ..$ nn.idx  : int [1:284, 1:5] 1 2 3 4 5 6 7 8 9 10 ...
#&gt;   ..$ nn.dists: num [1:284, 1:5] 0 0 0 0 0 0 0 0 0 0 ...
#&gt;  $ GadMARCM-F000122_seg001:List of 2
#&gt;   ..$ nn.idx  : int [1:297, 1:5] 42 42 42 42 42 42 9 9 9 9 ...
#&gt;   ..$ nn.dists: num [1:297, 1:5] 16.3 10.9 16.2 12.1 10.7 ...
#&gt;  $ GadMARCM-F000050_seg001:List of 2
#&gt;   ..$ nn.idx  : int [1:374, 1:5] 16 16 88 16 16 16 16 16 16 16 ...
#&gt;   ..$ nn.dists: num [1:374, 1:5] 14.43 15.13 8.74 11.25 11.69 ...</div></pre>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
    <h2>Contents</h2>
    <ul class="nav nav-pills nav-stacked">
      
      <li><a href="#details">Details</a></li>

      <li><a href="#performance">Performance</a></li>

      <li><a href="#see-also">See also</a></li>
      
      <li><a href="#examples">Examples</a></li>
    </ul>

  </div>
</div>

      <footer>
      <div class="copyright">
  <p>Developed by Gregory Jefferis, Stephane Mangenat.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.3.0.</p>
</div>
      </footer>
   </div>

  

  </body>
</html>

